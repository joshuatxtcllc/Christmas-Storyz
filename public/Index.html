<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Holiday Movie Poster â€“ Jay's Frames</title>
<script src="https://js.stripe.com/v3/"></script>
<style>
  :root{
    --bg:#0b0b0d;--panel:#141419;--ink:#e9eef2;--muted:#9aa0a6;
    --line:#23232b;--brand:#00d0b6;--accent:#f6b807;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 Inter,system-ui,Segoe UI,Arial,sans-serif}
  .wrap{max-width:1080px;margin:40px auto;padding:0 16px}
  .hero{margin-bottom:18px}
  .h1{font-size:28px;font-weight:900;margin:0}
  .sub{color:var(--muted);margin:6px 0 0}
  .grid{display:grid;gap:16px}
  @media(min-width:960px){.grid{grid-template-columns:1.1fr .9fr}}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px}
  .label{font-size:12px;color:var(--muted);margin-bottom:8px;display:block}
  
  .vibes{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .vibe{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0f0f13;cursor:pointer;transition:.2s}
  .vibe:hover{transform:translateY(-2px)}
  .vibe.active{outline:2px solid var(--brand);transform:translateY(-1px)}
  .poster{position:relative;width:100%;height:180px;display:grid;place-items:center;background:linear-gradient(135deg,#20222a 0%,#101116 60%);color:#cfe9e6}
  .poster:before{
    content:"";position:absolute;inset:8px;border:1px solid #2a2a31;border-radius:10px;pointer-events:none
  }
  
  .p-home{background:radial-gradient(60% 70% at 50% 40%, #244 0%, #111 65%)}
  .p-elf{background:radial-gradient(70% 80% at 50% 55%, #1d3a2e 0%, #101116 75%)}
  .p-vac{background:radial-gradient(70% 80% at 50% 55%, #3a2a1d 0%, #101116 75%)}
  .poster .badge{position:absolute;top:10px;left:10px;font-size:11px;padding:4px 8px;border-radius:999px;background:#0d1412;border:1px solid #2a2a31;color:#9adacf}
  .poster .title{font-weight:900;font-size:18px;letter-spacing:.5px;text-transform:uppercase}
  .poster .cast{position:absolute;bottom:10px;left:10px;right:10px;color:#b2b6bd;font-size:11px;text-align:center;opacity:.8}
  .vmeta{padding:10px 12px}
  .vmeta h4{margin:0;font-size:14px;font-weight:800}
  .vmeta p{margin:4px 0 0;color:var(--muted);font-size:12px}

  .upload{border:1px dashed #3a3a44;border-radius:12px;padding:16px;text-align:center;background:#0f0f13;position:relative}
  .upload.dragover{border-color:var(--brand);background:#0d1412}
  .upload input[type=file]{display:none}
  .btn{display:inline-flex;align-items:center;gap:8px;background:#15151b;border:1px solid #2a2a31;border-radius:10px;padding:10px 14px;color:var(--ink);font-weight:800;cursor:pointer;transition:.2s}
  .btn:hover{background:#1a1a21;border-color:#3a3a44}
  .tiny{font-size:12px;color:var(--muted);margin-top:6px}
  .thumb{margin:10px auto 0;width:120px;height:120px;border-radius:10px;border:1px solid #2a2a31;background:linear-gradient(135deg,#333,#111);display:grid;place-items:center;color:#9aa0a6;overflow:hidden}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .upload-progress{margin-top:8px;height:4px;background:#2a2a31;border-radius:2px;overflow:hidden}
  .upload-progress-bar{height:100%;background:var(--brand);transition:width .3s}

  .tiers{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
  .tier{border:1px solid var(--line);border-radius:12px;background:#0f0f13;padding:12px;cursor:pointer;transition:.2s}
  .tier:hover{border-color:#3a3a44}
  .tier.active{outline:2px solid var(--accent)}
  .tier h4{margin:0 0 6px;font-size:14px}
  .tier p{margin:0;color:var(--muted);font-size:12px}
  .price{margin-top:8px;font-weight:900;color:var(--ink)}

  .row2{display:grid;gap:10px;margin-top:12px}
  @media(min-width:560px){.row2{grid-template-columns:1fr 1fr}}

  input,textarea{
    width:100%;background:#0f0f13;border:1px solid #2a2a31;border-radius:10px;color:var(--ink);
    padding:10px 12px;font:14px/1.3 inherit;transition:.2s
  }
  input:focus,textarea:focus{outline:none;border-color:var(--brand)}
  input::placeholder,textarea::placeholder{color:#5a5a64}

  .total{display:flex;justify-content:space-between;align-items:center;margin-top:12px;padding:12px;border:1px solid var(--line);border-radius:12px;background:#0f0f13}
  .cta{width:100%;margin-top:12px;background:linear-gradient(90deg,var(--brand),#17e4c8);color:#041215;font-weight:900;border:0;border-radius:12px;padding:14px 16px;cursor:pointer;font-size:15px;transition:.2s}
  .cta:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,208,182,.3)}
  .cta:disabled{opacity:.5;cursor:not-allowed;transform:none}
  .note{color:var(--muted);font-size:12px;margin-top:8px}
  .divider{height:1px;background:var(--line);margin:14px 0}
  .error{color:#ff6b6b;font-size:12px;margin-top:4px}
  .success{color:var(--good);font-size:12px;margin-top:4px}
</style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <h1 class="h1">Your Family, Starring in a Holiday Classic</h1>
      <p class="sub">Pick a vibe Â· Upload one photo Â· Choose finish Â· We handle the magic. Limited run this season.</p>
    </header>

    <section class="grid">
      <div class="card">
        <label class="label">1) Pick your movie vibe</label>
        <div class="vibes" id="vibeSelector">
          <div class="vibe active" data-vibe="homeAlone">
            <div class="poster p-home">
              <div class="badge">Parody Art</div>
              <div class="title">HOME (ALONE-ISH)</div>
              <div class="cast">Kid screams center Â· parents peeking Â· cozy house motif</div>
            </div>
            <div class="vmeta">
              <h4>Home Alone</h4>
              <p>Funny family chaos energy</p>
            </div>
          </div>
          <div class="vibe" data-vibe="elf">
            <div class="poster p-elf">
              <div class="badge">Parody Art</div>
              <div class="title">THE ELF VIBE</div>
              <div class="cast">Tall elf silhouette Â· snowy skyline Â· candy cane accents</div>
            </div>
            <div class="vmeta">
              <h4>Elf</h4>
              <p>Wholesome + bright, kid-friendly</p>
            </div>
          </div>
          <div class="vibe" data-vibe="vacation">
            <div class="poster p-vac">
              <div class="badge">Parody Art</div>
              <div class="title">HOLIDAY CHAOS</div>
              <div class="cast">Dad with lights Â· comic sparks Â· suburban roof hint</div>
            </div>
            <div class="vmeta">
              <h4>Christmas Vacation</h4>
              <p>Iconic dad-energy mayhem</p>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <label class="label">2) Upload your main family photo</label>
        <div class="upload" id="uploadZone">
          <input type="file" id="fileInput" accept="image/jpeg,image/png,image/webp,image/heic">
          <button class="btn" id="uploadBtn">ðŸ“¤ Drag & drop or click to select</button>
          <div class="tiny">JPG/PNG/WEBP/HEIC Â· up to 25MB Â· One photo is enough</div>
          <div class="thumb" id="preview">Preview</div>
          <div class="upload-progress" id="uploadProgress" style="display:none">
            <div class="upload-progress-bar" id="uploadProgressBar"></div>
          </div>
          <div class="success" id="uploadSuccess" style="display:none"></div>
          <div class="error" id="uploadError" style="display:none"></div>
        </div>

        <div class="divider"></div>

        <label class="label">3) Choose your finish</label>
        <div class="tiers" id="tierSelector">
          <div class="tier active" data-tier="digital" data-price="79">
            <h4>Digital Only</h4>
            <p>High-res file for cards & socials</p>
            <div class="price">$79</div>
          </div>
          <div class="tier" data-tier="print" data-price="189">
            <h4>Fine-Art Print</h4>
            <p>Archival inkjet on museum paper</p>
            <div class="price">$189</div>
          </div>
          <div class="tier" data-tier="framed" data-price="399">
            <h4>Framed Edition</h4>
            <p>Premium frame, ready to hang</p>
            <div class="price">$399</div>
          </div>
        </div>

        <div class="row2">
          <label>
            <span class="label">Quantity</span>
            <input type="number" id="quantity" min="1" value="1">
          </label>
          <label>
            <span class="label">Notes (optional)</span>
            <input id="notes" placeholder="Pets to include? Wardrobe? Deadline?">
          </label>
        </div>
      </div>

      <div class="card">
        <label class="label">4) Checkout Details</label>
        <div class="row2">
          <label>
            <span class="label">Full Name *</span>
            <input id="customerName" placeholder="Jane Doe" required>
          </label>
          <label>
            <span class="label">Email *</span>
            <input type="email" id="customerEmail" placeholder="you@example.com" required>
          </label>
          <label>
            <span class="label">Phone (optional)</span>
            <input type="tel" id="customerPhone" placeholder="(555) 123-4567">
          </label>
          <label>
            <span class="label">Ship To (print/framed)</span>
            <input id="shippingAddress" placeholder="123 Main St, City, State 12345">
          </label>
        </div>

        <div class="total">
          <div>
            <div style="font-weight:900">Order Total</div>
            <div class="sub" id="orderSummary">Home Alone â€¢ digital â€¢ x1</div>
          </div>
          <div style="font-size:20px;font-weight:900" id="totalAmount">$79.00</div>
        </div>

        <button class="cta" id="checkoutBtn">Place Order</button>
        <div class="error" id="checkoutError" style="display:none"></div>
        <div class="note">We'll send a proof for approval before printing. Turnaround windows vary seasonally.</div>
      </div>
    </section>

    <footer class="note" style="margin-top:16px">
      Â© 2025 Jay's Frames â€” Hand-built parody poster art Â· archival printing Â· custom framing.
    </footer>
  </div>

  <script>
    // Configuration
    const STRIPE_KEY = 'pk_test_your_publishable_key'; // Replace with your key
    const stripe = Stripe(STRIPE_KEY);
    
    // State
    let selectedVibe = 'homeAlone';
    let selectedTier = 'digital';â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹
    let selectedTierPrice = 79;
    let uploadedFileId = null;
    let uploadedFileName = null;

    // Vibe selection
    document.getElementById('vibeSelector').addEventListener('click', (e) => {
      const vibe = e.target.closest('.vibe');
      if (!vibe) return;
      
      document.querySelectorAll('.vibe').forEach(v => v.classList.remove('active'));
      vibe.classList.add('active');
      selectedVibe = vibe.dataset.vibe;
      updateOrderSummary();
    });

    // Tier selection
    document.getElementById('tierSelector').addEventListener('click', (e) => {
      const tier = e.target.closest('.tier');
      if (!tier) return;
      
      document.querySelectorAll('.tier').forEach(t => t.classList.remove('active'));
      tier.classList.add('active');
      selectedTier = tier.dataset.tier;
      selectedTierPrice = parseInt(tier.dataset.price);
      updateOrderSummary();
    });

    // Quantity change
    document.getElementById('quantity').addEventListener('input', updateOrderSummary);

    // File upload
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const preview = document.getElementById('preview');

    uploadBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', handleFileSelect);

    // Drag and drop
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        handleFileSelect();
      }
    });

    async function handleFileSelect() {
      const file = fileInput.files[0];
      if (!file) return;

      // Validate file
      const validTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/heic'];
      if (!validTypes.includes(file.type)) {
        showError('uploadError', 'Please upload a valid image file (JPG, PNG, WEBP, or HEIC)');
        return;
      }

      if (file.size > 25 * 1024 * 1024) {
        showError('uploadError', 'File size must be under 25MB');
        return;
      }

      // Show preview
      const reader = new FileReader();
      reader.onload = (e) => {
        preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
      };
      reader.readAsDataURL(file);

      // Upload file
      const formData = new FormData();
      formData.append('photo', file);

      try {
        document.getElementById('uploadProgress').style.display = 'block';
        document.getElementById('uploadProgressBar').style.width = '0%';
        hideError('uploadError');
        hideSuccess('uploadSuccess');

        // Simulate progress
        let progress = 0;
        const progressInterval = setInterval(() => {
          progress += 10;
          if (progress <= 90) {
            document.getElementById('uploadProgressBar').style.width = `${progress}%`;
          }
        }, 100);

        const response = await fetch('/api/upload', {
          method: 'POST',
          body: formData
        });

        clearInterval(progressInterval);
        document.getElementById('uploadProgressBar').style.width = '100%';

        if (!response.ok) {
          throw new Error('Upload failed');
        }

        const data = await response.json();
        uploadedFileId = data.uploadId;
        uploadedFileName = data.filename;
        
        showSuccess('uploadSuccess', `âœ“ Photo uploaded successfully: ${file.name}`);
        setTimeout(() => {
          document.getElementById('uploadProgress').style.display = 'none';
        }, 1000);

      } catch (error) {
        console.error('Upload error:', error);
        showError('uploadError', 'Upload failed. Please try again.');
        document.getElementById('uploadProgress').style.display = 'none';
      }
    }

    // Update order summary
    function updateOrderSummary() {
      const vibeNames = {
        homeAlone: 'Home Alone',
        elf: 'Elf',
        vacation: 'Christmas Vacation'
      };

      const tierNames = {
        digital: 'Digital',
        print: 'Print',
        framed: 'Framed'
      };

      const quantity = parseInt(document.getElementById('quantity').value) || 1;
      const total = selectedTierPrice * quantity;

      document.getElementById('orderSummary').textContent = 
        `${vibeNames[selectedVibe]} â€¢ ${tierNames[selectedTier]} â€¢ x${quantity}`;
      document.getElementById('totalAmount').textContent = `$${total.toFixed(2)}`;
    }

    // Checkout
    document.getElementById('checkoutBtn').addEventListener('click', async () => {
      hideError('checkoutError');

      // Validation
      const customerName = document.getElementById('customerName').value.trim();
      const customerEmail = document.getElementById('customerEmail').value.trim();
      const customerPhone = document.getElementById('customerPhone').value.trim();
      const shippingAddress = document.getElementById('shippingAddress').value.trim();
      const notes = document.getElementById('notes').value.trim();
      const quantity = parseInt(document.getElementById('quantity').value) || 1;

      if (!customerName) {
        showError('checkoutError', 'Please enter your full name');
        return;
      }

      if (!customerEmail || !isValidEmail(customerEmail)) {
        showError('checkoutError', 'Please enter a valid email address');
        return;
      }

      if (!uploadedFileId) {
        showError('checkoutError', 'Please upload a photo before checking out');
        return;
      }

      if ((selectedTier === 'print' || selectedTier === 'framed') && !shippingAddress) {
        showError('checkoutError', 'Shipping address is required for physical products');
        return;
      }

      // Disable button
      const checkoutBtn = document.getElementById('checkoutBtn');
      checkoutBtn.disabled = true;
      checkoutBtn.textContent = 'Processing...';

      try {
        const response = await fetch('/api/create-checkout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            vibe: selectedVibe,
            tier: selectedTier,
            quantity,
            uploadId: uploadedFileId,
            customerName,
            customerEmail,
            customerPhone,
            shippingAddress,
            notes
          })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'Checkout failed');
        }

        const { url } = await response.json();
        
        // Redirect to Stripe Checkout
        window.location.href = url;

      } catch (error) {
        console.error('Checkout error:', error);
        showError('checkoutError', error.message || 'Checkout failed. Please try again.');
        checkoutBtn.disabled = false;
        checkoutBtn.textContent = 'Place Order';
      }
    });

    // Helper functions
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function showError(elementId, message) {
      const element = document.getElementById(elementId);
      element.textContent = message;
      element.style.display = 'block';
    }

    function hideError(elementId) {
      document.getElementById(elementId).style.display = 'none';
    }

    function showSuccess(elementId, message) {
      const element = document.getElementById(elementId);
      element.textContent = message;
      element.style.display = 'block';
    }

    function hideSuccess(elementId) {
      document.getElementById(elementId).style.display = 'none';
    }

    // Initialize
    updateOrderSummary();
  </script>
</body>
</html>
